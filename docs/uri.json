{
  "folders": [
    "design-survey",
    "customize-question-types"
  ],
  "rename": {
    "design-survey-question-titles": "design-survey-configure-question-titles",
    "design-survey-conditional-display": "design-survey-conditional-logic",
    "design-survey-predefine-answers": "design-survey-pre-populate-form-fields",
    "localization": "survey-localization",
    "handle-survey-results-access": "access-and-modify-survey-results",
    "handle-survey-results-store": "how-to-store-survey-results",
    "handle-survey-results-continue-incomplete": "how-to-save-and-restore-incomplete-survey"
  },
  "classRename": {
    "surveymodel": "survey-data-model",
    "pagemodel": "page-model",
    "popupsurveymodel": "pop-up-survey-model",
    "questiontextmodel": "text-entry-question-model",
    "questioncheckboxmodel": "checkbox-question-model",
    "questionrankingmodel": "ranking-question-model",
    "questionradiogroupmodel": "radio-button-question-model",
    "questiondropdownmodel": "dropdown-menu-model",
    "questiontagboxmodel": "dropdown-tag-box-model",
    "questioncommentmodel": "comment-field-model",
    "questionratingmodel": "rating-scale-question-model",
    "questionimagepickermodel": "image-picker-question-model",
    "questionbooleanmodel": "boolean-question-model",
    "questionimagemodel": "add-image-to-survey",
    "questionhtmlmodel": "add-custom-html-to-survey",
    "questionsignaturepadmodel": "signature-pad-model",
    "questionexpressionmodel": "expression-model",
    "questionfilemodel": "file-model",
    "questionmatrixmodel": "matrix-table-question-model",
    "panelmodel": "panel-model",
    "questionpaneldynamicmodel": "dynamic-panel-model",
    "questionmultipletextmodel": "multiple-text-entry-question-model",
    "questionmatrixdynamicmodel": "dynamic-matrix-table-question-model",
    "questionmatrixdropdownmodel": "matrix-table-with-dropdown-list"
  }
}

<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1100 1050" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1100" height="1050" fill="#F0F2F5" />
  
  <!-- Title -->
  <rect x="20" y="20" width="1060" height="60" rx="5" ry="5" fill="#2E5BFF" stroke="none" />
  <text x="550" y="60" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold" fill="white">Web Authentication Flow with Auth0</text>
  
  <!-- Components -->
  
  <!-- Web Browser -->
  <rect x="50" y="130" width="200" height="80" rx="5" ry="5" fill="#FFFFFF" stroke="#555555" stroke-width="2" />
  <text x="150" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Web Browser</text>
  <text x="150" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">User's Browser Session</text>
  
  <!-- Auth0 -->
  <rect x="450" y="130" width="200" height="80" rx="5" ry="5" fill="#EB5424" stroke="#555555" stroke-width="2" />
  <text x="550" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="white">Auth0</text>
  <text x="550" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#FFF">Identity Provider</text>
  
  <!-- ASP.NET Web App -->
  <rect x="850" y="130" width="200" height="80" rx="5" ry="5" fill="#FFFFFF" stroke="#555555" stroke-width="2" />
  <text x="950" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">ASP.NET Web App</text>
  <text x="950" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">Your Application</text>
  
  <!-- Flow Steps -->
  
  <!-- Step 1: Initial Request -->
  <rect x="20" y="260" width="1060" height="80" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="290" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 1: Initial Request</text>
  <text x="50" y="320" font-family="Arial" font-size="14">User navigates to application or protected resource without authentication cookies</text>
  
  <!-- Step 1 Flow -->
  <path d="M150 210 L150 260" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M150 340 L150 380 L950 380 L950 340" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="550" y="370" font-family="Arial" font-size="14" text-anchor="middle" fill="#666">HTTP Request without auth cookies</text>
  
  <!-- Step 2: Auth0SessionModule Detects No Auth -->
  <rect x="20" y="420" width="1060" height="110" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="450" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 2: Auth0SessionModule Detects No Authentication</text>
  <text x="50" y="480" font-family="Arial" font-size="14">• Auth0SessionModule.OnAuthenticateRequest checks for FormsAuthentication cookie</text>
  <text x="50" y="505" font-family="Arial" font-size="14">• No auth cookie found, redirects to /Account/Index</text>
  
  <!-- Auth Details Box -->
  <rect x="700" y="450" width="350" height="60" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="480" font-family="Arial" font-size="12" fill="#555">Checks HttpContext.Request.Cookies[FormsAuthentication.FormsCookieName]</text>
  <text x="720" y="500" font-family="Arial" font-size="12" fill="#555">Also tracks redirects to prevent infinite loops</text>
  
  <!-- Step 3: Account Controller Initiates Auth0 Challenge -->
  <rect x="20" y="570" width="1060" height="130" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="600" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 3: AccountController Initiates Auth0 Challenge</text>
  <text x="50" y="630" font-family="Arial" font-size="14">• Browser gets redirected to /Account/Index</text>
  <text x="50" y="655" font-family="Arial" font-size="14">• AccountController.Login() calls HttpContext.GetOwinContext().Authentication.Challenge()</text>
  <text x="50" y="680" font-family="Arial" font-size="14">• OWIN middleware redirects to Auth0 login page</text>
  
  <!-- Auth0 Challenge Details Box -->
  <rect x="700" y="610" width="350" height="70" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="630" font-family="Arial" font-size="12" fill="#555">OpenIdConnectAuthenticationOptions configured in Startup.cs</text>
  <text x="720" y="650" font-family="Arial" font-size="12" fill="#555">Uses client ID, domain, and other settings from config</text>
  <text x="720" y="670" font-family="Arial" font-size="12" fill="#555">Includes "prompt=login" to force re-authentication</text>
  
  <!-- Flow arrows for Steps 2-3 -->
  <path d="M950 530 L950 570" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M950 700 L950 740 L150 740 L150 700" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="550" y="730" font-family="Arial" font-size="14" text-anchor="middle" fill="#666">HTTP 302 Redirect to Auth0</text>
  
  <path d="M150 740 L150 770 L550 770 L550 700" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="350" y="760" font-family="Arial" font-size="14" text-anchor="middle" fill="#666">Redirect to Auth0 login page</text>
  
  <!-- Step 4: User Authenticates with Auth0 -->
  <rect x="20" y="810" width="1060" height="110" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="840" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 4: User Authenticates with Auth0</text>
  <text x="50" y="870" font-family="Arial" font-size="14">• User enters credentials on Auth0 login page</text>
  <text x="50" y="895" font-family="Arial" font-size="14">• Auth0 validates credentials and redirects back to your app with authorization code</text>
  
  <!-- Auth0 Authentication Details Box -->
  <rect x="700" y="840" width="350" height="60" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="860" font-family="Arial" font-size="12" fill="#555">Auth0 handles all authentication logic</text>
  <text x="720" y="880" font-family="Arial" font-size="12" fill="#555">Can include MFA, social logins, enterprise connections</text>
  <text x="720" y="900" font-family="Arial" font-size="12" fill="#555">Returns code + state parameters to callback URL</text>
  
  <!-- Flow arrows for Step 4 -->
  <path d="M550 810 L550 770" fill="none" stroke="#666" stroke-width="2" marker-start="url(#arrowhead)" />
  <path d="M550 920 L550 960 L950 960 L950 920" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="750" y="950" font-family="Arial" font-size="14" text-anchor="middle" fill="#666">Redirect to callback URL with auth code</text>
  
  <!-- Step 5: Complete Authentication Flow -->
  <rect x="20" y="960" width="1060" height="70" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="990" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 5: Complete Authentication</text>
  <text x="50" y="1015" font-family="Arial" font-size="14">See next diagram for details on how the auth code is processed and identity established</text>
  
  <!-- Component Highlight Boxes -->
  <rect x="825" y="355" width="250" height="220" rx="5" ry="5" fill="none" stroke="#2E5BFF" stroke-width="2" stroke-dasharray="5,5" />
  <text x="950" y="545" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#2E5BFF">HTTP Modules Layer</text>
  
  <rect x="825" y="585" width="250" height="160" rx="5" ry="5" fill="none" stroke="#EB5424" stroke-width="2" stroke-dasharray="5,5" />
  <text x="950" y="735" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#EB5424">Controller Layer</text>

  <!-- Arrowhead marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#000" />
    </marker>
  </defs>
</svg>

<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1100 1300" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1100" height="1300" fill="#F0F2F5" />
  
  <!-- Title -->
  <rect x="20" y="20" width="1060" height="60" rx="5" ry="5" fill="#2E5BFF" stroke="none" />
  <text x="550" y="60" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold" fill="white">Web Authentication Flow with Auth0 - Part 2</text>
  
  <!-- Components -->
  
  <!-- Web Browser -->
  <rect x="50" y="130" width="200" height="80" rx="5" ry="5" fill="#FFFFFF" stroke="#555555" stroke-width="2" />
  <text x="150" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Web Browser</text>
  <text x="150" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">User's Browser Session</text>
  
  <!-- Auth0 -->
  <rect x="450" y="130" width="200" height="80" rx="5" ry="5" fill="#EB5424" stroke="#555555" stroke-width="2" />
  <text x="550" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="white">Auth0</text>
  <text x="550" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#FFF">Identity Provider</text>
  
  <!-- ASP.NET Web App -->
  <rect x="850" y="130" width="200" height="80" rx="5" ry="5" fill="#FFFFFF" stroke="#555555" stroke-width="2" />
  <text x="950" y="170" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">ASP.NET Web App</text>
  <text x="950" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">Your Application</text>
  
  <!-- Flow Steps -->
  
  <!-- Step 6: Auth0 Callback Processing -->
  <rect x="20" y="260" width="1060" height="130" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="290" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 6: Auth0 Callback Processing</text>
  <text x="50" y="320" font-family="Arial" font-size="14">• Browser redirected to your application's callback URL with auth code</text>
  <text x="50" y="345" font-family="Arial" font-size="14">• OWIN middleware intercepts the request and processes the auth code</text>
  <text x="50" y="370" font-family="Arial" font-size="14">• Middleware exchanges code for tokens and extracts user information</text>
  
  <!-- Callback Details Box -->
  <rect x="700" y="290" width="350" height="80" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="310" font-family="Arial" font-size="12" fill="#555">OpenIdConnectAuthenticationNotifications.SecurityTokenValidated</text>
  <text x="720" y="330" font-family="Arial" font-size="12" fill="#555">Validates token, extracts claims like email</text>
  <text x="720" y="350" font-family="Arial" font-size="12" fill="#555">Maps email to userId using BmsDbUow</text>
  <text x="720" y="370" font-family="Arial" font-size="12" fill="#555">Creates new ClaimsIdentity with user info</text>
  
  <!-- Step 7: Redirect to AccountController.UserInfo -->
  <rect x="20" y="430" width="1060" height="110" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="460" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 7: Redirect to AccountController.UserInfo</text>
  <text x="50" y="490" font-family="Arial" font-size="14">• OWIN middleware completes and redirects to returnUrl (AccountController.UserInfo)</text>
  <text x="50" y="515" font-family="Arial" font-size="14">• Request now has authenticated User.Identity with claims from Auth0</text>
  
  <!-- Flow arrows for Steps 6-7 -->
  <path d="M150 210 L150 260" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M150 390 L150 430" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M150 540 L150 580" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Step 8: FormsAuthentication SignIn -->
  <rect x="20" y="580" width="1060" height="180" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="610" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 8: FormsAuthentication SignIn</text>
  <text x="50" y="640" font-family="Arial" font-size="14">• AccountController.UserInfo verifies that User.Identity.IsAuthenticated is true</text>
  <text x="50" y="665" font-family="Arial" font-size="14">• Retrieves user email from claims and looks up user information from database</text>
  <text x="50" y="690" font-family="Arial" font-size="14">• Calls _formsAuthentication.SignIn(userId, false) to create Forms Authentication cookies</text>
  <text x="50" y="715" font-family="Arial" font-size="14">• Also creates SessionTimestamp cookie to track session state across tabs</text>
  <text x="50" y="740" font-family="Arial" font-size="14">• Redirects to Home page or other appropriate destination</text>
  
  <!-- FormsAuth Details Box -->
  <rect x="700" y="610" width="350" height="130" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="630" font-family="Arial" font-size="12" fill="#555" font-weight="bold">FormsAuthentication.SignIn() creates:</text>
  <text x="720" y="655" font-family="Arial" font-size="12" fill="#555">1. Authentication cookie (BMSWebAuthCookie)</text>
  <text x="720" y="675" font-family="Arial" font-size="12" fill="#555">2. SessionTimestamp cookie</text>
  <text x="720" y="695" font-family="Arial" font-size="12" fill="#555">3. TimeoutIndicator cookie</text>
  <text x="720" y="715" font-family="Arial" font-size="12" fill="#555">Cookie includes user roles, session GUID,</text>
  <text x="720" y="735" font-family="Arial" font-size="12" fill="#555">IP address, and other session information</text>
  
  <!-- Step 9: Subsequent Requests -->
  <rect x="20" y="800" width="1060" height="150" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="830" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 9: Subsequent Requests</text>
  <text x="50" y="860" font-family="Arial" font-size="14">• Browser includes authentication cookies in all subsequent requests</text>
  <text x="50" y="885" font-family="Arial" font-size="14">• Auth0SessionModule validates FormsAuthentication cookie:</text>
  <text x="80" y="910" font-family="Arial" font-size="14">- Checks cookie existence, expiration, and TrueClientIP match</text>
  <text x="80" y="935" font-family="Arial" font-size="14">- Validates the SessionTimestamp cookie is present (prevents multi-tab issues)</text>
  
  <!-- Module Details Box -->
  <rect x="700" y="840" width="350" height="90" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="860" font-family="Arial" font-size="12" fill="#555">BmsSessionModule also processes the request:</text>
  <text x="720" y="880" font-family="Arial" font-size="12" fill="#555">• Validates FormsAuth ticket expiration</text>
  <text x="720" y="900" font-family="Arial" font-size="12" fill="#555">• Updates LastActivityDate in database</text>
  <text x="720" y="920" font-family="Arial" font-size="12" fill="#555">• Ensures consistent user identity in pipeline</text>
  
  <!-- Step 10: Session Timeout Handling -->
  <rect x="20" y="990" width="1060" height="120" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="1020" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 10: Session Timeout Handling</text>
  <text x="50" y="1050" font-family="Arial" font-size="14">• If FormsAuthentication cookie expires or is invalid, Auth0SessionModule triggers re-authentication</text>
  <text x="50" y="1075" font-family="Arial" font-size="14">• Redirects back to /Account/Index which starts the authentication flow again</text>
  <text x="50" y="1100" font-family="Arial" font-size="14">• Redirect count tracking prevents infinite redirect loops</text>
  
  <!-- Session Timeout Details Box -->
  <rect x="700" y="1020" width="350" height="70" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="1040" font-family="Arial" font-size="12" fill="#555">Cookie expiration set in ApplicationSettings</text>
  <text x="720" y="1060" font-family="Arial" font-size="12" fill="#555">Typical value: 20-30 minutes for web sessions</text>
  <text x="720" y="1080" font-family="Arial" font-size="12" fill="#555">RedirectCount cookie prevents infinite loops</text>
  
  <!-- Step 11: Logout Process -->
  <rect x="20" y="1150" width="1060" height="130" rx="5" ry="5" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" />
  <text x="50" y="1180" font-family="Arial" font-size="16" font-weight="bold" fill="#2E5BFF">Step 11: Logout Process</text>
  <text x="50" y="1210" font-family="Arial" font-size="14">• User clicks logout, sending request to AccountController.Logout</text>
  <text x="50" y="1235" font-family="Arial" font-size="14">• Controller calls _formsAuthentication.SignOut() to clear cookies</text>
  <text x="50" y="1260" font-family="Arial" font-size="14">• Also signs out of Auth0 via OWIN middleware and redirects to login page</text>
  
  <!-- Logout Details Box -->
  <rect x="700" y="1190" width="350" height="70" rx="5" ry="5" fill="#F8F9F9" stroke="#DDDDDD" stroke-width="1" />
  <text x="720" y="1210" font-family="Arial" font-size="12" fill="#555">FormsAuthentication.SignOut() clears all cookies</text>
  <text x="720" y="1230" font-family="Arial" font-size="12" fill="#555">LogoutCookieModule ensures thorough cleanup</text>
  <text x="720" y="1250" font-family="Arial" font-size="12" fill="#555">Auth0 session terminated through OWIN signout</text>
  
  <!-- Flow arrows for Steps 8-11 -->
  <path d="M150 760 L150 800" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M150 950 L150 990" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  <path d="M150 1110 L150 1150" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Component Highlight Boxes -->
  <rect x="825" y="580" width="250" height="180" rx="5" ry="5" fill="none" stroke="#2E5BFF" stroke-width="2" stroke-dasharray="5,5" />
  <text x="950" y="750" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#2E5BFF">FormsAuthentication</text>
  
  <rect x="825" y="800" width="250" height="150" rx="5" ry="5" fill="none" stroke="#2a9d8f" stroke-width="2" stroke-dasharray="5,5" />
  <text x="950" y="940" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#2a9d8f">HTTP Modules</text>
  
  <!-- Arrowhead marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#000" />
    </marker>
  </defs>
</svg>
